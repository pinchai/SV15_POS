<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CRUD With Javascript</title>
  <link rel="stylesheet" href="boostrap.css">
</head>
<style>
    .form_box {
        background-color: whitesmoke;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 1px 0px 13px 8px #ccc;
    }
</style>
<body>
<div class="container-fluid">
  <div class="row">
    <!--    Form-->
    <div class="col-lg-4 col-md-4 col-sm-12 mt-3">
      <div class="form_box">
        <form method="get" action="#">
          <!--        Name-->
          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" class="form-control" id="name">
          </div>
          <!--        Category-->
          <div class="form-group">
            <label for="category">Category</label>
            <select id="category" class="form-control">
              <option value="drink">Drink</option>
              <option value="food">Food</option>
              <option value="water">Water</option>
            </select>
          </div>
          <!--Price-->
          <div class="form-group">
            <div class="form-group">
              <label for="price">Price</label>
              <input min="10" max="85" type="number" class="form-control" id="price">
            </div>
          </div>
          <!--image URL-->
          <div class="form-group">
            <div class="form-group">
              <label for="image_url">image URL</label>
              <input type="url" class="form-control" id="image_url">
            </div>
          </div>
          <!--btn-->
          <div class="form-group">
            <input type="button" class="btn btn-primary float-right" value="Save" id="btn_save">
            <input type="button" class="btn btn-danger" value="Cancel" id="btn_cancel">
          </div>
        </form>
      </div>
    </div>

    <!--Table-->
    <div class="col-8 col-md-8 col-sm-12 mt-3">
      <div class="table-responsive">
        <table id="user_table" class="table table-borderless table-striped">
          <thead>
          <tr class="bg-primary text-white">
            <th>#</th>
            <th>Name</th>
            <th>category</th>
            <th>Price</th>
            <th>image</th>
            <th>Action</th>
          </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
</body>
<script src="./sweetalert2.js"></script>
<script>
    let input_name = document.getElementById('name')
    let input_category = document.getElementById('category')
    let input_price = document.getElementById('price')
    let input_image_url = document.getElementById('image_url')
    let btn_save = document.getElementById('btn_save')
    let btn_cancel = document.getElementById('btn_cancel')
    let user_table = document.querySelector('#user_table tbody')

    let product_list = JSON.parse(localStorage.getItem('product_list') ?? '[]')
    renderTr()

    console.log(product_list)
    btn_save.addEventListener('click', function () {
        let name = input_name.value
        let category = input_category.value
        let price = input_price.value
        let image_url = input_image_url.value
        let id = Math.random() + Math.random();
        id = id.toString()
        id = id.replace('.', '')
        if (name == null || name.trim() == '') {
            Swal.fire({
                title: "Field Error",
                text: "Name field can not empty !",
                icon: "error"
            });
            return
        }
        if (price == null || price.trim() == '') {
            Swal.fire({
                title: "Field Error",
                text: "price field can not empty !",
                icon: "error"
            });
            if (parseInt(price) < 0) {
                Swal.fire({
                    title: "Field Error",
                    text: "price field must start from 0",
                    icon: "error"
                });
            }
            return
        }

        product_list.push(
            {
                id,
                name,
                category,
                price,
                image_url
            }
        )
        localStorage.setItem('product_list', JSON.stringify(product_list))

        renderTr()
        clearForm()
    })

    function renderTr() {
        //render tr
        let index = 0
        user_table.innerHTML = ''
        for (let item of product_list) {
            index++
            let new_tr = document.createElement('tr')
            new_tr.innerHTML = `
            <td>${index}</td>
            <td>${item.name}</td>
            <td>${item.category}</td>
            <td>${item.price}</td>
            <td>
              <img
                style="width: 50px"
               src="${item.image_url}"
               alt=""
               width="100px"
              ></img>
            </td>
            <td>
                <input type="button" value="Edit" class="btn btn-sm btn-warning">
                <input onclick="deleteItem(${index - 1})" type="button" value="Delete" class="btn btn-sm btn-danger">
            </td>
          `
            user_table.appendChild(new_tr)
        }
    }

    function deleteItem(index) {
        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                product_list.splice(index, 1)
                localStorage.setItem('product_list', JSON.stringify(product_list))
                renderTr()
            }
        });
    }

    function clearForm() {
        input_name.value = ''
        input_category.value = 'male'
        input_price.value = ''
        input_image_url.value = ''
    }
    btn_cancel.addEventListener('click', function () {
        Swal.fire({
            title: "Are you sure?",
            text: "Do you want to cancel !",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes i do it"
        }).then((result) => {
            if (result.isConfirmed) {
                clearForm()
            }
        });

    })
</script>
</html>